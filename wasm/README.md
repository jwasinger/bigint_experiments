This directory has some sample source and output wasm files. They are generated by the `Makefile` in this directory and file(s) in the parent directory.

# Dependencies

CMake is required to compile dependencies. This is usually available in system repositories, eg `apt install cmake`.

We use `LLVM8+` to compile to wasm. This should be available in recent versions of Ubuntu. Or you may be able to find binaries online. As a last result, you can compile it following the standard instructions below.
```
git clone https://github.com/llvm/llvm-project.git
mkdir llvm-project/build && cd llvm-project/build
cmake -G 'Unix Makefiles' -DLLVM_ENABLE_PROJECTS="clang;libcxx;libcxxabi;lld" ../llvm
make -j4	# this takes hours, may fail and need a restart with the same make command, may crash your system if you don't have enough ram or disk.
cd ../..
```

We use wabt to transform between Wasm text and binary format, specifically `wasm2wat` and `wat2wasm`. And, optionally, we use `wasm-interp` to execute. You can download a release of the binaries, or compile it like below.
```
git clone https://github.com/webassembly/wabt.git       #18MB
cd wabt
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTS=OFF ..
make    # should output executables wasm2wat, wat2wasm, and wasm-interp
cd ../..
```

We use binaryen tool `wasm-opt` to optimize Wasm binaries. You can download a release of the binaries, or compile it like below.
```
git clone https://github.com/webassembly/binaryen.git       #141 MB
cd binaryen
mkdir build && cd build
cmake ..
make    # should output executable bin/wasm-opt
cd ../..
```

Because Wasm doesn't support multiplication `u64xu64->u128`, if you need it, use the precompiled version builtin `__multi3()` to link against with `wasm-ld`, see Makefile for the exact command.
```
wget https://github.com/CraneStation/wasi-sdk/releases/download/wasi-sdk-5/libclang_rt.builtins-wasm32-wasi-5.0.tar.gz
tar -xvzf libclang_rt.builtins-wasm32-wasi-5.0.tar.gz
```


# Compile

llvm, wabt, and binaryen binaries must be called in the Makefile. Either (i) they are already visible, (ii) you can update your `PATH` system variable with directories of these binaries, (iii) you can manually set path to the binaries at the top of the Makefile, or (v) you set give these path variables as arguments to make.

Then you can compile specific functions.

```
make mul256_32bitlimbs
make montmul256_64bitlimbs
make montsquare256_32bitlimbs
```

See the makefile for creating your own recipies.


# Bench

```
make montmul256_32bitlimbs_bench
```

See the makefile and `bench.c` for creating your own benchmarks.

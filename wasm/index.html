<!--
this file:
  - arbitrary precision integers as strings and as arrays 32-bit integers
  - testing webassembly functions with metering
-->


<html>

<head>

  <script>
function init(){
  if (!('WebAssembly' in window)) {
    document.getElementById("wasm_support").innerHTML="WebAssembly is not supported by your browser";
    //alert('you need a browser with wasm support enabled :(');
  }
}


/*
TEST WEBASSEMBLY METERING
*/
function run_wasm_xhr_custom(filename,funcname){
  console.log("run_wasm_xhr("+filename+","+funcname+")");
  //document.getElementById("div_results").innerHTML = "";
  let xhr = new XMLHttpRequest();
  xhr.open('GET', filename, true); //method, url, async
  xhr.responseType = 'arraybuffer';
  xhr.send();
  xhr.onload = function(){
    //prepare imports
    let imports = {};
    //create instance, and its callback
    WebAssembly.instantiate(xhr.response, imports).then(module => {
      //EXECUTE
      try {
        console.log("executing...");
        let t0 = performance.now();
        let output = module.instance.exports[funcname]();
        //let output = module.instance.exports._main256_64bitlimbs();
        let t1 = performance.now();
        console.log("runtime: " + (t1 - t0) + " millisecs.");
        document.getElementById("div_results").innerHTML = funcname+" runtime:" + (t1 - t0).toFixed(2) + " millisecs.<br><br>" + document.getElementById("div_results").innerHTML;
      }
      catch(err) {
        document.getElementById("div_results").innerHTML = err + "<br><br>" + document.getElementById("div_results").innerHTML;
      }
    });
  }
}
  </script>
</head>

<body onload="init()">
<div id="wasm_support" align="center"></div>
<div align="center">
  filename: <input type="text" size="50" id="input_wasm_filename" value="bench_montmul256_32bitlimbs.wasm"><br>
  funcname: <input type="text" size="50" id="input_wasm_funcname" value="bench_montmul256_32bitlimbs"><br>
  <input type="button" id="button_run_wasm_xhr_custom" onclick="run_wasm_xhr_custom(document.getElementById('input_wasm_filename').value, document.getElementById('input_wasm_funcname').value);"  value="run filename.wasm funcname()"/><br>
</div>
<div id="div_results" align="center"></div>

</body>
</html>
